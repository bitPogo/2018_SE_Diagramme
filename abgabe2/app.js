var Data = [
    {
        "name": "Westbegrenzung",
        "cluster": [
            [
                [
                    "Axtemis-Heiligtum",
                    10,
                    0,
                    56,
                    [ 43, 20 ],
                    1
                ],
                [
                    "Chalkedon/Kadiköy",
                    10,
                    0,
                    [ 56, 50 ],
                    [ 43, 5],
                    1
                ],
                [
                    "Kap Akritas/Tuzla Burun",
                    10,
                    0,
                    [ 56, 30 ],
                    [ 42, 45 ],
                    1
                ],
                [
                    "Trarion",
                    10,
                    0,
                    [ 56, 45 ],
                    [ 42, 45 ],
                    1
                ]
            ],
            [
                [
                    "Astakos/Gülcük",
                    10,
                    0,
                    57,
                    [ 42, 40 ],
                    1
                ],
                [
                    "Nikomedia/Izmit",
                    10,
                    0,
                    [ 57, 20 ],
                    [ 42, 30 ],
                    1
                ],
                [
                    "Olbia/Cinarcik",
                    10,
                    0,
                    57,
                    [ 42, 30 ],
                    1
                ]
            ],
            [
                [
                    "Kap Poseidion/Bozburun",
                    10,
                    0,
                    [ 56, 30 ],
                    [ 42, 25 ],
                    1
                ],
                [
                    "Askanios-/Gemlik Dere Mündung",
                    10,
                    0,
                    [ 56, 30 ],
                    [ 42, 15 ],
                    1
                ],
                [
                    "Askania-See/Iznik Gölü",
                    10,
                    0,
                    [ 57, 45 ],
                    42,
                    1
                ],
                [
                    "Prusias/Gemlik",
                    10,
                    0,
                    [ 57, 20 ],
                    [ 42, 5 ],
                    1
                ],
                [
                    "Apameia/Mudanya",
                    10,
                    0,
                    [ 56, 55 ],
                    42,
                    1
                ],
                [
                    "Daskylion/Eskel",
                    10,
                    0,
                    [ 56, 35 ],
                    [ 41, 55 ],
                    1
                ],
                [
                    "Rhyndakos-/Adirnas-Mündung",
                    10,
                    0,
                    [ 56, 20 ],
                    [ 41, 45 ],
                    1
                ]/*,
                [
                    "Quellen des Flusses",
                    10,
                    0,
                    57,
                    [ 40, 30 ],
                    1
                ]*/
            ]
        ]
    },
    {
        "name": "Nordbegrenzung",
        "cluster": [
            [
                [
                    "Kap Bithynia",
                    10,
                    0,
                    [ 56, 45 ],
                    [ 43, 20 ],
                    1
                ],
                [
                    "Arteke/Erdek, ein Kastell",
                    10,
                    0,
                    57,
                    [ 43, 15 ],
                    //[ 43, 55 ],
                    1
                ],
                [
                    "Psyllis-/Göksu-Mündung",
                    10,
                    0,
                    [ 57, 15 ],
                    [ 43, 15 ],
                    //[ 43, 5 ],
                    1
                ],
                [
                    "Kalpa-/Ilalﬂi Dere-Mündung",
                    10,
                    0,
                    [ 57, 40 ],
                    [ 43, 5 ],
                    //43,
                    1
                ],
                [
                    "Sangaraios-/Sakarya-Mündung",
                    10,
                    0,
                    58,
                    [ 42, 45 ],
                    1
                ]/*,
                [
                    "erste Krümmung des Flusses",
                    10,
                    0,
                    [ 58, 30 ],
                    42,
                    1
                ],
                [
                    "zweite Krümmung des Flusses",
                    10,
                    0,
                    [ 61, 20 ],
                    42,
                    1
                ],
                [
                    "dritte Krümung des Flusses",
                    10,
                    0,
                    [ 58, 45 ],
                    41,
                    1
                ],
                [
                    "Quelle des Flusses",
                    10,
                    0,
                    [ 60, 50 ],
                    [ 40, 50 ],
                    1
                ]*/
            ],
            [
                [
                    "Hypios-/Büyük Melen Su-Mündung",
                    10,
                    0,
                    [ 58, 40 ],
                    //[ 58, 50 ],
                    [ 42, 45 ],
                    //43,
                    1
                ],
                [
                    "Elata-Mündung",
                    10,
                    0,
                    [ 58, 50 ],
                    43,
                    1
                ],
                [
                    "Diospoljs/Akcakoca",
                    10,
                    0,
                    [ 58, 45 ],
                    [ 43, 20 ],
                    1
                ],
                [
                    "Herakleia am Pontos/Eregli",
                    10,
                    0,
                    59,
                    [ 43, 30 ],
                    1
                ],
                [
                    "Psylleion",
                    10,
                    0,
                    [ 59, 30 ],
                    [ 43, 30 ],
                    1
                ],
                [
                    "Tion/Hisarönü",
                    10,
                    0,
                    60,
                    [ 43, 30 ],
                    1
                ],
                [
                    "Parthenios-/Bartjn Su-Mündung",
                    10,
                    0,
                    [ 60, 15 ],
                    [ 43, 30 ],
                    1
                ],
                /*[
                    "Quellen des Flusses",
                    10,
                    0,
                    [ 62, 30 ],
                    [ 42, 20 ],
                    1
                ],*/
                [
                    "Amastris/Amasra",
                    10,
                    0,
                    [ 60, 30 ],
                    [ 43, 30 ],
                    1
                ],
                [
                    "Kromna/Tekeönü",
                    10,
                    0,
                    [ 60, 35 ],
                    [ 43, 35 ],
                    1
                ],
                [
                    "Kytoros/Kidros",
                    10,
                    0,
                    [ 60, 45 ],
                    [ 43, 35 ],
                    1
                ]
            ]
        ]
    },
    {
        "name":"Südgrenze",
        "cluster": [
            [
                /*[
                    "Rhyndakos-/Adirnas-Mündung",
                    10,
                    0,
                    [ 56, 20 ],
                    [ 41, 45 ],
                    1
                ],*/
                [
                    "Quellen des Flusses",
                    10,
                    0,
                    57,
                    [ 40, 30 ],
                    1
                ],
                [
                    "Grenzpunkt",
                    10,
                    0,
                    61,
                    [ 41, 15 ],
                    1
                ]
            ]
        ]
    },
    {
        "name":"Ostgrenze",
        "cluster": [
            [
                [
                    "Grenzpunkt",
                    10,
                    0,
                    61,
                    [ 41, 15 ],
                    1
                ],
                [
                    "Kytoros/Kidros",
                    10,
                    0,
                    [ 60, 45 ],
                    [ 43, 35 ],
                    1
                ]
            ]
        ]
    },
    {
       "comment":"Borderglue",
       "cluster": [
           [
               [
                   "Rhyndakos-/Adirnas-Mündung",
                   10,
                   0,
                   [ 56, 20 ],
                   [ 41, 45 ],
                   1
               ],
               [
                   "Quellen des Flusses",
                   10,
                   0,
                   57,
                   [ 40, 30 ],
                   1
               ]
           ],
           [
               [
                   "Axtemis-Heiligtum",
                   10,
                   0,
                   56,
                   [ 43, 20 ],
                   1
               ],
               [
                   "Kap Bithynia",
                   10,
                   0,
                   [ 56, 45 ],
                   [ 43, 20 ],
                   1
               ]
           ]

       ]
    },
    {
        "comment": "Gebiete",
        "expansion":[
            {
                "name": "Chalkedonier",
                "p1":[
                    56,
                    [ 43, 20 ]
                ],
                "p2":[
                    [ 60, 45 ],
                    [ 43, 35 ]
                ],
                "x1":10,
                "x2":10,
                "y1":0,
                "y2":0,
                "rotate":0
            },
            {
                "name": "Mariadyner",
                "p1":[
                    59,
                    [ 43, 30 ]
                ],
                "p2":[
                    [ 55, 40 ],
                    [ 42, 45 ]
                ],
                "x1":10,
                "x2":10,
                "y1":0,
                "y2":0,
                "rotate":0
            }
        ]
    },
    {
        "comment": "Städte",
        "height": 5,
        "width": 5,
        "color": "#90ba3e",
        "coordinates":[
            [
                "Libyssa/Tavsancil",
                10,
                0,
                [ 57, 20 ],
                [ 42, 15 ],
                1
            ],
            [
                "Eriboia/Sakar Köy",
                10,
                0,
                [ 57, 10 ],
                [ 42, 20 ],
                1
            ],
            [
                "Gallika",
                10,
                0,
                [ 57, 45 ],
                [ 42, 25 ],
                1
            ],
            [
                "Tatavion/Geyve",
                10,
                0,
                [ 57, 45 ],
                42,
                1
            ],
            [
                "Prusa am Hypios/Konuralp",
                10,
                0,
                [ 58, 30 ],
                [ 42, 35 ],
                1
            ],
            [
                "Dedakana",
                10,
                0,
                59,
                [ 42, 25 ],
                1
            ],
            [
                "Protomakrai",
                10,
                0,
                [ 58, 45 ],
                42,
                1
            ],
            [
                "Klaudiopolis/Bithynion/Bolu",
                10,
                0,
                [ 59, 20 ],
                [ 42, 45 ],
                1
            ],
            [
                "Flaviopolis/Krateia/Gerede",
                10,
                0,
                60,
                43,
                1
            ],
            [
                "Timaia/Rumeli Kavagi",
                10,
                0,
                [ 59, 45 ],
                [ 42, 20 ],
                1
            ],
            [
                "Klitai",
                10,
                0,
                [ 60, 30 ],
                43,
                1
            ],
            [
                "Laganeia (Lagania)/Beypazari",
                10,
                0,
                [ 60, 35 ],
                [ 42, 30 ],
                1
            ],
            [
                "Nikaia/Iznik",
                10,
                0,
                58,
                [ 42, 15 ],
                1
            ],
            [
                "Caesareia/Smyraleia/Zeytinbagi",
                10,
                0,
                [ 56, 40 ],
                [ 41, 40 ],
                1
            ],
            [
                "Prusa am Olymp/Bursa",
                10,
                0,
                57,
                [ 41, 40 ],
                1
            ],
            [
                "Agrilion/Gökcescu",
                10,
                0,
                [ 57, 30 ],
                [ 41, 40 ],
                1
            ],
            [
                "Dableis/Cayköy",
                10,
                0,
                [ 58, 40 ],
                [ 41, 40 ],
                1
            ],
            [
                "Dadastana",
                10,
                0,
                [ 59, 30 ],
                [ 41, 45 ],
                1
            ],
            [
                "Iuliopolus/Sarila",
                10,
                0,
                [ 60, 10 ],
                42,
                1
            ]
        ]
    },
    {
        "comment": "Inseln",
        "coordinates": [
            [
                "Kyaneen/Orektasi",
                10,
                0,
                [ 56, 30 ],
                [ 43, 25 ],
                2,
                '#663300'
            ],
            [
                "Thynias/Daphnusa/Kefken Adasi",
                10,
                0,
                [ 57, 40 ],
                [ 43, 20 ],
                2,
                '#663300'
            ],
            [
                "Klippen, Erythinoi",
                10,
                0,
                [ 58, 30 ],
                [ 43, 15 ],
                2,
                '#663300'
            ]
        ]
    },
    {
        'comment': 'Flüsse',
        'cluster': [
            [
                [
                    "Rhyndakos-/Adirnas-Mündung",
                    10,
                    0,
                    [ 56, 20 ],
                    [ 41, 45 ],
                    1,
                    '#0066ff'
                ],
                [
                    "Quellen des Flusses",
                    10,
                    0,
                    57,
                    [ 40, 30 ],
                    1,
                    '#0066ff'
                ]
            ],
            [
                [
                    "Sangaraios-/Sakarya-Mündung",
                    10,
                    0,
                    58,
                    [ 42, 45 ],
                    1,
                    '#0066ff'
                ],
                [
                    "erste Krümmung des Flusses",
                    10,
                    0,
                    [ 58, 30 ],
                    42,
                    1,
                    '#0066ff'
                ],
                [
                    "zweite Krümmung des Flusses",
                    10,
                    0,
                    [ 61, 20 ],
                    42,
                    1,
                    '#0066ff'
                ],
                [
                    "dritte Krümung des Flusses",
                    10,
                    0,
                    [ 58, 45 ],
                    41,
                    1,
                    '#0066ff'
                ],
                [
                    "Quelle des Flusses",
                    10,
                    0,
                    [ 60, 50 ],
                    [ 40, 50 ],
                    1,
                    '#0066ff'
                ]
            ],
            [
                [
                    "Parthenios-/Bartjn Su-Mündung",
                    10,
                    0,
                    [ 60, 15 ],
                    [ 43, 30 ],
                    1,
                    '#0066ff'
                ],
                [
                    "Quellen des Flusses",
                    10,
                    0,
                    [ 62, 30 ],
                    [ 42, 20 ],
                    1,
                    '#0066ff'
                ]
            ]
        ]
    }
];

//Step 1 minutes to Grad & Normalize
var Part, Pointer, Points, Point, Line;
var DrawPoints = [];
var DrawLines = [];
var DrawExpansion = [];
var XFactor = 54;
var YFactor = 34;
var MinX = 9999;
var MaxX = 0;
var MinY = 9999;
var MaxY = 0;
var Bridge = false;

function minutesToGrad( Minute )
{
    Minute *= 1/60
    return Minute;
}

function calcGrad( Where, Index, Factor )
{
    if( true === Array.isArray( Where[Index] ) )
    {
        Where[Index] = Where[Index][0] + minutesToGrad( Where[Index][1] );
    }

    if( 3 === Index )
    {
        MinX = Math.min( MinX, Where[3] );
        MaxX = Math.max( MaxX, Where[3] );
    }
    else if( 4 === Index )
    {
        MinY = Math.min( MinY, Where[4] );
        MaxY = Math.max( MaxY, Where[4] );
    }

    Where[ Index ] -= Factor;
    Where[ Index ] *= 100;
    Where[ Index ] = parseFloat( Where[ Index ].toFixed( 2 ) );
}

function normalize( Where )
{
    calcGrad( Where, 3, XFactor );
    calcGrad( Where, 4, YFactor );
}

for( Part = 0; Data.length > Part; Part++ )
{
    if( 'cluster' in Data[Part] )
    {
        Pointer = Data[Part]['cluster'];

        if( 'name' in Data[ Part ] )
        {
            Bridge = true;
        }
        else
        {
            Bridge = false;
        }

        for( Points = 0; Pointer.length > Points; Points++ )
        {
            Line = [];
            DrawLines.push( Line );

            for( Point = 0; Point < Pointer[ Points ].length; Point++ )
            {
                normalize( Pointer[ Points ][Point] );
                if( Points > 0 && 0 === Point && false === ( 'comment' in Data[Part] ) )
                {
                    Line.push( [
                        Pointer[Points-1][Pointer[Points-1].length-1][3],
                        Pointer[Points-1][Pointer[Points-1].length-1][4]

                    ] );
                }
                if( 'comment' in Data[Part] && 'Flüsse' !== Data[Part]['comment'] )
                {
                    DrawPoints.push( Pointer[ Points ][ Point ] );
                }

                if( 6 in Pointer[ Points ][ Point ] )
                {
                    Line.push([Pointer[Points][Point][3], Pointer[Points][Point][4], Pointer[Points][Point][6]]);
                }
                else
                {
                    Line.push([Pointer[Points][Point][3], Pointer[Points][Point][4]]);
                }
            }
        }
    }
    else if( 'expansion' in Data[Part] )
    {
        Pointer = Data[Part]['expansion'];
        for( Points in Pointer )
        {
            calcGrad(Pointer[Points]['p1'], 0, XFactor);
            calcGrad(Pointer[Points]['p1'], 1, YFactor);
            calcGrad(Pointer[Points]['p2'], 0, XFactor);
            calcGrad(Pointer[Points]['p2'], 1, YFactor);
            DrawExpansion.push( Pointer[Points] );
        }
    }
    else
    {
        Pointer = Data[Part]['coordinates'];
        for( Points in Pointer )
        {
            normalize( Pointer[ Points ] );
            DrawPoints.push( Pointer[ Points ] )
        }
    }

}

/*console.log( JSON.stringify( Data, null, 4 ) )
console.log( JSON.stringify( DrawPoints, null, 4 ) )
console.log( JSON.stringify( DrawLines, null, 4 ) )*/

//Step 2 Draw
var DrawPoint, Poly;
var Canvas = document.getElementById( 'app' );
Painter = Canvas.getContext( "2d" );
for( Point in DrawPoints )
{
    //console.log( `${ DrawPoints[Point][0] }:${ DrawPoints[Point][3] }:${ DrawPoints[Point][4] }:${ DrawPoints[Point][5] }`);
    Painter.beginPath();
    Painter.arc( DrawPoints[Point][3],1000-DrawPoints[Point][4], DrawPoints[Point][5], 0, 2 * Math.PI);
    if( 6 in DrawPoints[Point] )
    {
        Painter.fillStyle = DrawPoints[Point][6];
        Painter.fill();
    }
    Painter.stroke();
}

for( Poly in DrawLines )
{
    Painter.beginPath();
    Painter.moveTo( DrawLines[Poly][0][0], 1000-DrawLines[Poly][0][1] )
    for( Line = 1; Line < DrawLines[Poly].length; Line++ )
    {
        Painter.lineTo( DrawLines[Poly][Line][0], 1000-DrawLines[Poly][Line][1] )
        if( 2 in DrawLines[Poly][Line] )
        {
            Painter.strokeStyle = DrawLines[Poly][Line][2];
        }
    }
    Painter.stroke();
}


console.log( `${ MinX }:${ MaxX }` );
console.log( `${ MinY }:${ MaxY }` );
