var Data = [
    {
        "name": "Westbegrenzung",
        "cluster": [
            [
                [
                    "Axtemis-Heiligtum",
                    [ -190, 60 ],
                    -45,
                    56,
                    [ 43, 20 ],
                    3,
                    'gold'
                ],
                [
                    "Chalkedon/Kadiköy",
                    [ 5, -3 ],
                    0,
                    [ 56, 50 ],
                    [ 43, 5],
                    3,
                    '#000000'
                ],
                [
                    "Kap Akritas/Tuzla Burun",
                    [ -390, 25 ],
                    -45,
                    [ 56, 30 ],
                    [ 42, 45 ],
                    2,
                    'brown'
                ],
                [
                    "Trarion",
                    [ 5, 0 ],
                    0,
                    [ 56, 45 ],
                    [ 42, 45 ],
                    3,
                    '#000000'
                ]
            ],
            [
                [
                    "Astakos/Gülcük",
                    [ 5, 0 ],
                    0,
                    57,
                    [ 42, 40 ],
                    3,
                    '#000000'
                ],
                [
                    "Nikomedia/Izmit",
                    [ 5, -3 ],
                    0,
                    [ 57, 20 ],
                    [ 42, 30 ],
                    3,
                    '#000000'
                ],
                [
                    "Olbia/Cinarcik",
                    [ 5, -15 ],
                    0,
                    57,
                    [ 42, 30 ],
                    3,
                    '#000000'
                ]
            ],
            [
                [
                    "Kap Poseidion/Bozburun",
                    [ -450, 50 ],
                    -45,
                    [ 56, 30 ],
                    [ 42, 25 ],
                    2,
                    'brown'
                ],
                [
                    "Askanios-/Gemlik Dere Mündung",
                    [ 5, 3 ],
                    0,
                    [ 56, 30 ],
                    [ 42, 15 ],
                    2,
                    '#0066ff'
                ],
                [
                    "Askania-See/Iznik Gölü",
                    [ 90, 120 ],
                    15,
                    [ 57, 45 ],
                    42,
                    5,
                    '#0066ff'
                ],
                [
                    "Prusias/Gemlik",
                    [ 5, 2 ],
                    0,
                    [ 57, 20 ],
                    [ 42, 5 ],
                    3,
                    '#000000'
                ],
                [
                    "Apameia/Mudanya",
                    [ 5, -10 ],
                    0,
                    [ 56, 55 ],
                    42,
                    3,
                    '#000000'
                ],
                [
                    "Daskylion/Eskel",
                    [ 5, -10 ],
                    0,
                    [ 56, 35 ],
                    [ 41, 55 ],
                    3,
                    '#000000'
                ],
                [
                    "Rhyndakos-/Adirnas-Mündung",
                    [ 5, -3 ],
                    45,
                    [ 56, 20 ],
                    [ 41, 45 ],
                    1
                ]
            ]
        ]
    },
    {
        "name": "Nordbegrenzung",
        "cluster": [
            [
                [
                    "Kap Bithynia",
                    [ -245, -75 ],
                    -45,
                    [ 56, 45 ],
                    [ 43, 20 ],
                    2,
                    'brown'
                ],
                [
                    "Arteke/Erdek, ein Kastell",
                    [ -278, -113 ],
                    -45,
                    57,
                    [ 43, 15 ],
                    //[ 43, 55 ],
                    3,
                    'red'
                ],
                [
                    "Psyllis-/Göksu-Mündung",
                    [ -295, -158 ],
                    -45,
                    [ 57, 15 ],
                    [ 43, 15 ],
                    //[ 43, 5 ],
                    2,
                    '#0066ff'
                ],
                [
                    "Kalpa-/Ilalﬂi Dere-Mündung",
                    [ -355, -220 ],
                    -45,
                    [ 57, 40 ],
                    [ 43, 5 ],
                    //43,
                    0,
                    '#000'
                ],
                [
                    "Sangaraios-/Sakarya-Mündung",
                    [ -442, -252 ],
                    -45,
                    58,
                    [ 42, 45 ],
                    0
                ]
            ],
            [
                [
                    "Hypios-/Büyük Melen Su-Mündung",
                    [ -80, -15 ],
                    0,
                    [ 58, 40 ],
                    //[ 58, 50 ],
                    [ 42, 45 ],
                    //43,
                    2,
                    '#0066ff'
                ],
                [
                    "Elata-Mündung",
                    [ 5, -3 ],
                    0,
                    [ 58, 50 ],
                    43,
                    2,
                    '#0066ff'
                ],
                [
                    "Diospoljs/Akcakoca",
                    [ 5, -3 ],
                    0,
                    [ 58, 45 ],
                    [ 43, 20 ],
                    3,
                    '#000000'
                ],
                [
                    "Herakleia am Pontos/Eregli",
                    [ -380, -485 ],
                    -45,
                    59,
                    [ 43, 30 ],
                    3,
                    '#000000'
                ],
                [
                    "Psylleion",
                    [ -415, -572 ],
                    -45,
                    [ 59, 30 ],
                    [ 43, 30 ],
                    3,
                    '#000000'
                ],
                [
                    "Tion/Hisarönü",
                    [ -450, -662 ],
                    -45,
                    60,
                    [ 43, 30 ],
                    3,
                    '#000000'
                ],
                [
                    "Parthenios-/Bartjn Su-Mündung",
                    [ -475, -705 ],
                    -45,
                    [ 60, 15 ],
                    [ 43, 30 ],
                    2,
                    '#0066ff'
                ],
                [
                    "Amastris/Amasra",
                    [ -505, -735 ],
                    -45,
                    [ 60, 30 ],
                    [ 43, 30 ],
                    3,
                    '#000000'
                ],
                [
                    "Kromna/Tekeönü",
                    [ -480, -772 ],
                    -45,
                    [ 60, 35 ],
                    [ 43, 35 ],
                    3,
                    '#000000'
                ],
                [
                    "Kytoros/Kidros",
                    [ -495, -802 ],
                    -45,
                    [ 60, 45 ],
                    [ 43, 35 ],
                    3,
                    '#000000'
                ]
            ]
        ]
    },
    {
        "name":"Südgrenze",
        "cluster": [
            [
                [
                    //"Quellen des Flusses",
                    "",
                    [ 5, -3 ],
                    0,
                    57,
                    [ 40, 30 ],
                    0
                ],
                [
                    "Grenzpunkt",
                    [ 98, 357 ],
                    15,
                    61,
                    [ 41, 15 ],
                    1
                ]
            ]
        ]
    },
    {
        "name":"Ostgrenze",
        "cluster": [
            [
                [
                    //"Grenzpunkt",
                    "",
                    [ 5, -3 ],
                    0,
                    61,
                    [ 41, 15 ],
                    0
                ],
                [
                    //"Kytoros/Kidros",
                    "",
                    [ 5, -3 ],
                    0,
                    [ 60, 45 ],
                    [ 43, 35 ],
                    0
                ]
            ]
        ]
    },
    {
        "comment":"Borderglue",
        "cluster": [
            [
                [
                    //"Rhyndakos-/Adirnas-Mündung",
                    "",
                    [ 5, -3 ],
                    0,
                    [ 56, 20 ],
                    [ 41, 45 ],
                    0
                ],
                [
                    //"Quellen des Flusses",
                    "",
                    [ 5, -3 ],
                    0,
                    57,
                    [ 40, 30 ],
                    0
                ]
            ],
            [
                [
                    //"Axtemis-Heiligtum",
                    "",
                    [ 5, -3 ],
                    0,
                    56,
                    [ 43, 20 ],
                    0
                ],
                [
                    //"Kap Bithynia",
                    "",
                    [ 5, -3 ],
                    0,
                    [ 56, 45 ],
                    [ 43, 20 ],
                    0
                ]
            ]

        ]
    },
    {
        "comment": "Gebiete",
        "expansion":[
            {
                "name": "Mariadyner",
                "regionColor": '#b3ffb3',
                'color': '#000000',
                "style": "20px times new roman",
                "width": 50,
                "rotate":-13,
                "margin": [ -500, -170 ],
                "p1": [
                    59,
                    [ 43, 30 ]
                ],
                "p2":[
                    [ 55, 40 ],
                    [ 42, 45 ]
                ]
            },
            {
                "name": "Chalkedonier",
                "regionColor": '#b3ffb3',
                'color': '#000000',
                "style": "20px times new roman",
                "width": 50,
                "rotate":0,
                "margin": [ 550, 25 ],
                "p1":[
                    56,
                    [ 43, 20 ]
                ],
                "p2":[
                    [ 60, 45 ],
                    [ 43, 35 ]
                ]
            }
        ]
    },
    {
        "comment": "Städte",
        "coordinates":[
            [
                "Libyssa/Tavsancil",
                [ 5, -3 ],
                0,
                [ 57, 20 ],
                [ 42, 15 ],
                3,
                '#000000'
            ],
            [
                "Eriboia/Sakar Köy",
                [ 5, -3 ],
                0,
                [ 57, 10 ],
                [ 42, 20 ],
                3,
                '#000000'
            ],
            [
                "Gallika",
                [ 5, -3 ],
                0,
                [ 57, 45 ],
                [ 42, 25 ],
                3,
                '#000000'
            ],
            [
                "Tatavion/Geyve",
                [ 5, -3 ],
                0,
                [ 57, 45 ],
                42,
                3,
                '#000000'
            ],
            [
                "Prusa am Hypios/Konuralp",
                [ 5, -3 ],
                0,
                [ 58, 30 ],
                [ 42, 35 ],
                3,
                '#000000'
            ],
            [
                "Dedakana",
                [ 5, -3 ],
                0,
                59,
                [ 42, 25 ],
                3,
                '#000000'
            ],
            [
                "Protomakrai",
                [ -625, -332 ],
                -45,
                [ 58, 45 ],
                42,
                3,
                '#000000'
            ],
            [
                "Klaudiopolis/Bithynion/Bolu",
                [ 5, -3 ],
                0,
                [ 59, 20 ],
                [ 42, 45 ],
                3,
                '#000000'
            ],
            [
                "Flaviopolis/Krateia/Gerede",
                [ 5, -3 ],
                0,
                60,
                43,
                3,
                '#000000'
            ],
            [
                "Timaia/Rumeli Kavagi",
                [ 5, -3 ],
                0,
                [ 59, 45 ],
                [ 42, 20 ],
                3,
                '#000000'
            ],
            [
                "Klitai",
                [ 5, -3 ],
                0,
                [ 60, 30 ],
                43,
                3,
                '#000000'
            ],
            [
                "Laganeia (Lagania)/Beypazari",
                [ -153, -3 ],
                0,
                [ 60, 35 ],
                [ 42, 30 ],
                3,
                '#000000'
            ],
            [
                "Nikaia/Iznik",
                [ 5, -3 ],
                0,
                58,
                [ 42, 15 ],
                3,
                '#000000'
            ],
            [
                "Caesareia/Smyraleia/Zeytinbagi",
                [ -237, -27],
                -20,
                [ 56, 40 ],
                [ 41, 40 ],
                3,
                '#000000'
            ],
            [
                "Prusa am Olymp/Bursa",
                [ -242, -55],
                -20,
                57,
                [ 41, 40 ],
                3,
                '#000000'
            ],
            [
                "Agrilion/Gökcescu",
                [ 5, -3 ],
                0,
                [ 57, 30 ],
                [ 41, 40 ],
                3,
                '#000000'
            ],
            [
                "Dableis/Cayköy",
                [ 5, -3 ],
                0,
                [ 58, 40 ],
                [ 41, 40 ],
                3,
                '#000000'
            ],
            [
                "Dadastana",
                [ 5, -3 ],
                0,
                [ 59, 30 ],
                [ 41, 45 ],
                3,
                '#000000'
            ],
            [
                "Iuliopolus/Sarila",
                [ -730, -581 ],
                -45,
                [ 60, 10 ],
                42,
                3,
                '#000000'
            ]
        ]
    },
    {
        "comment": "Inseln",
        "coordinates": [
            [
                "Kyaneen/Orektasi",
                [ -210, -37 ],
                -45,
                [ 56, 30 ],
                [ 43, 25 ],
                3,
                '#663300'
            ],
            [
                "Thynias/Daphnusa/Kefken Adasi",
                [ -310, -238 ],
                -45,
                [ 57, 40 ],
                [ 43, 20 ],
                3,
                '#663300'
            ],
            [
                "Klippen, Erythinoi",
                [ -388, -380 ],
                -45,
                [ 58, 30 ],
                [ 43, 15 ],
                3,
                '#663300'
            ]
        ]
    },
    {
        'comment': 'Flüsse',
        'cluster': [
            [
                [
                    //"Rhyndakos-/Adirnas-Mündung",
                    "",
                    [ 5, -3 ],
                    0,
                    [ 56, 20 ],
                    [ 41, 45 ],
                    1,
                    '#0066ff'
                ],
                [
                    "Quellen des Flusses",
                    [ -765, 90 ],
                    -45,
                    57,
                    [ 40, 30 ],
                    1,
                    '#0066ff'
                ]
            ],
            [
                [
                    //"Sangaraios-/Sakarya-Mündung",
                    "",
                    [ 5, -3 ],
                    0,
                    58,
                    [ 42, 45 ],
                    2,
                    '#0066ff'
                ],
                [
                    "erste Krümmung des Flusses",
                    [ -610, -285 ],
                    -45,
                    [ 58, 30 ],
                    42,
                    1,
                    '#0066ff'
                ],
                [
                    "zweite Krümmung des Flusses",
                    [ 4, -3 ],
                    0,
                    [ 61, 20 ],
                    42,
                    1,
                    '#0066ff'
                ],
                [
                    "dritte Krümung des Flusses",
                    [ -1600, 145 ],
                    -90,
                    [ 58, 45 ],
                    41,
                    1,
                    '#0066ff'
                ],
                [
                    "Quelle des Flusses",
                    [ 4, -3 ],
                    0,
                    [ 60, 50 ],
                    [ 40, 50 ],
                    1,
                    '#0066ff'
                ]
            ],
            [
                [
                    //"Parthenios-/Bartjn Su-Mündung",
                    "",
                    [ 5, -3 ],
                    0,
                    [ 60, 15 ],
                    [ 43, 30 ],
                    1,
                    '#0066ff'
                ],
                [
                    "Quellen des Flusses",
                    [ 4, -3 ],
                    0,
                    [ 62, 30 ],
                    [ 42, 20 ],
                    1,
                    '#0066ff'
                ]
            ],
            //blue fix
            [
                [
                    '',
                    [ 5, -3 ],
                    0,
                    [ 57, 40 ],
                    [ 43, 5 ],
                    //43,
                    2,
                    '#0066ff'
                ]
            ]
        ]
    }
];

//Step 1 minutes to Grad & Normalize
var Part, Pointer, Points, Point, Line, Copy;
var DrawPoints = [];
var DrawLines = [];
var DrawExpansion = [];
var XFactor = 55.9;
var YFactor = 40.4;
var Bridge = false;
var Multiplikator = 250;
//56:62.5
//app.js:883 40.5:43.583333333333336

function minutesToGrad( Minute )
{
    Minute *= 1/60
    return Minute;
}

function calcGrad( Where, Index, Factor )
{
    if( true === Array.isArray( Where[Index] ) )
    {
        Where[Index] = Where[Index][0] + minutesToGrad( Where[Index][1] );
    }

    Where[ Index ] -= Factor;
    Where[ Index ] *= Multiplikator;
    Where[ Index ] = parseFloat( Where[ Index ].toFixed( 2 ) );
}

function normalize( Where )
{
    calcGrad( Where, 3, XFactor );
    calcGrad( Where, 4, YFactor );
}

for( Part = 0; Data.length > Part; Part++ )
{
    if( 'cluster' in Data[Part] )
    {
        Pointer = Data[Part]['cluster'];

        if( 'name' in Data[ Part ] )
        {
            Bridge = true;
        }
        else
        {
            Bridge = false;
        }

        for( Points = 0; Pointer.length > Points; Points++ )
        {
            Line = [];
            DrawLines.push( Line );

            for( Point = 0; Point < Pointer[ Points ].length; Point++ )
            {
                normalize( Pointer[ Points ][Point] );
                if( Points > 0 && 0 === Point && false === ( 'comment' in Data[Part] ) )
                {
                    Copy = Pointer[Points-1][Pointer[Points-1].length-1].slice()
                    Copy[0] = '';
                    Line.push( [
                        Copy[3],
                        Copy[4]

                    ] );
                }
                //if( 'comment' in Data[Part] && 'Flüsse' !== Data[Part]['comment'] )
                //{
                DrawPoints.push( Pointer[ Points ][ Point ] );
                //}

                if( 6 in Pointer[ Points ][ Point ] )
                {
                    Line.push([Pointer[Points][Point][3], Pointer[Points][Point][4], Pointer[Points][Point][6]]);
                }
                else
                {
                    Line.push([Pointer[Points][Point][3], Pointer[Points][Point][4]]);
                }
            }
        }
    }
    else if( 'expansion' in Data[Part] )
    {
        Pointer = Data[Part]['expansion'];
        for( Points in Pointer )
        {
            calcGrad(Pointer[Points]['p1'], 0, XFactor);
            calcGrad(Pointer[Points]['p1'], 1, YFactor);
            calcGrad(Pointer[Points]['p2'], 0, XFactor);
            calcGrad(Pointer[Points]['p2'], 1, YFactor);
            DrawExpansion.push( Pointer[Points] );
        }
    }
    else
    {
        Pointer = Data[Part]['coordinates'];
        for( Points in Pointer )
        {
            normalize( Pointer[ Points ] );
            DrawPoints.push( Pointer[ Points ] )
        }
    }

}


//Step 2 Draw
console.log(DrawExpansion)
var Y1, Y2, Y, Poly, Region;
var Canvas = document.getElementById( 'app' );
Painter = Canvas.getContext( "2d" );

for( Region = 0; DrawExpansion.length > Region; Region++ )
{
    Painter.beginPath();
    Y1 = 1000-DrawExpansion[Region]['p1'][1];
    Y2 = 1000-DrawExpansion[Region]['p2'][1];
    Painter.strokeStyle = DrawExpansion[Region]['regionColor'];
    Painter.moveTo( DrawExpansion[Region]['p1'][0], Y1 );
    Painter.lineWidth = DrawExpansion[Region]['width'];
    Painter.lineTo(  DrawExpansion[Region]['p2'][0], Y2 );
    Painter.stroke();
    Painter.lineWidth = 1;
    if( 0 !==  DrawExpansion[Region]['rotate'] )
    {
        Painter.save();
        Painter.transform( 1, 0, 0, 1, 0, 0 );
        Painter.rotate( DrawExpansion[Region]['rotate']*Math.PI/180 )
    }
    Painter.strokeStyle = DrawExpansion[Region]['color'];
    Painter.font = `${ DrawExpansion[Region]['style'] }`;
    Painter.strokeText(
        DrawExpansion[Region]['name'],
        DrawExpansion[Region]['p1'][0] + DrawExpansion[Region]['margin'][0],
        Y1 - DrawExpansion[Region]['margin'][1]
    );

    if( 0 !==  DrawExpansion[Region]['rotate'] )
    {
        Painter.restore();
    }
}

for( Poly in DrawLines )
{
    Painter.beginPath();
    Painter.strokeStyle = '#000000';
    Painter.moveTo( DrawLines[Poly][0][0], 1000-DrawLines[Poly][0][1] );
    for( Line = 1; Line < DrawLines[Poly].length; Line++ )
    {
        Painter.lineTo( DrawLines[Poly][Line][0], 1000-DrawLines[Poly][Line][1] );
        if( 2 in DrawLines[Poly][Line] )
        {
            Painter.strokeStyle = DrawLines[Poly][Line][2];
        }
    }
    Painter.stroke();
}


for( Point in DrawPoints )
{
    //console.log( `${ DrawPoints[Point][0] }:${ DrawPoints[Point][3] }:${ DrawPoints[Point][4] }:${ DrawPoints[Point][5] }`);
    Painter.beginPath();
    Y = 1000-DrawPoints[Point][4];
    Painter.strokeStyle = '#000000';
    Painter.arc( DrawPoints[Point][3], Y, DrawPoints[Point][5], 0, 2 * Math.PI);
    if( 6 in DrawPoints[Point] )
    {
        Painter.fillStyle = DrawPoints[Point][6];
        Painter.fill();
    }
    Painter.stroke();

    if( 0 !== DrawPoints[Point][2] )
    {
        Painter.save();
        Painter.transform( 1, 0, 0, 1, 0, 0 );
        Painter.rotate( DrawPoints[Point][2]*Math.PI/180 )
    }

    if( 0 < DrawPoints[Point][0].length )
    {
        Painter.font = "12px times new roman";
        Painter.strokeText(
            DrawPoints[Point][0],
            DrawPoints[Point][3] + DrawPoints[Point][1][0],
            Y - DrawPoints[Point][1][1]
        );
    }

    if( 0 !== DrawPoints[Point][2] )
    {
        Painter.restore();
        //Painter.transform(1, 1, 0, 1, 1, 0);
        //Painter.rotate(-DrawPoints[Point][2] * Math.PI / 180)
    }
}

